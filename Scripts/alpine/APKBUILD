# Contributor: Remko Tronçon <r@mko.re>
# Maintainer: Remko Tronçon <r@mko.re>
pkgname=age-plugin-se
pkgver=0.1.2
pkgrel=0
pkgdesc="age plugin for Apple's Secure Enclave"
url="https://github.com/remko/age-plugin-se"
arch="aarch64 x86_64"
license="MIT"
depends=""
depends_doc=""
makedepends="make debootstrap scdoc"
checkdepends=""
options="!check !tracedeps" # !check because the binary only works if the dynamic linker is at the correct absolute path
install=""
subpackages="$pkgname-doc"
source="
 	${pkgname}-${pkgver}.tar.gz::https://github.com/remko/age-plugin-se/archive/refs/tags/v${pkgver}.tar.gz 
 	chroot-build.sh"
builddir="$srcdir/age-plugin-se-${pkgver}"

repo="main"

build() {
	cd $builddir
	doas env PREFIX=/usr $srcdir/chroot-build.sh || return 1
	doas chown -R $USER.$USER $builddir/.build || return 1
	make .build/age-plugin-se.1 || return 1
}

check() {
	:
}

package() {
	install -d "$pkgdir"
	cp -r $builddir/.build/chroot-build/* "$pkgdir" || return 1
	make PREFIX=/usr DESTDIR="$pkgdir" install-doc || return 1
}

sha512sums="
57a412be140a0a39646c00e7a73bea09e00324a2c82b57c34f14a9116a457c4aa1a2fd9ec3e6fd9128d2d2453c3efaf3014f42641b6ec5f8f55cd345098a7938  age-plugin-se-0.1.2.tar.gz
f558fcb211e844a02f5a059d2fd802556424285855bb0a223611ce6537e352c93745fefaa2baef5c2f92605b8b7f2b38aeaaa639c3aef98319dc4bc721e42291  chroot-build.sh
"
